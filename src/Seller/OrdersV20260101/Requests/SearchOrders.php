<?php

/**
 * This file is auto-generated by Saloon SDK Generator
 * Generator: SellingPartnerApi\Generator\Generators\RequestGenerator
 * Do not modify it directly.
 */

declare(strict_types=1);

namespace SellingPartnerApi\Seller\OrdersV20260101\Requests;

use Exception;
use Saloon\Enums\Method;
use Saloon\Http\Response;
use SellingPartnerApi\Request;
use SellingPartnerApi\Seller\OrdersV20260101\Responses\ErrorList;
use SellingPartnerApi\Seller\OrdersV20260101\Responses\SearchOrdersResponse;

/**
 * searchOrders
 */
class SearchOrders extends Request
{
    protected Method $method = Method::GET;

    /**
     * @param  ?\DateTimeInterface  $createdAfter  The response includes orders created at or after this time. The date must be in [ISO 8601](https://developer-docs.amazon.com/sp-api/docs/iso-8601) format.
     *
     * **Note**: You must provide exactly one of `createdAfter` and `lastUpdatedAfter` in your request. If `createdAfter` is provided, neither `lastUpdatedAfter` nor `lastUpdatedBefore` may be provided.
     * @param  ?\DateTimeInterface  $createdBefore  The response includes orders created at or before this time. The date must be in [ISO 8601](https://developer-docs.amazon.com/sp-api/docs/iso-8601) format.
     *
     * **Note**: If you include `createdAfter` in the request, `createdBefore` is optional, and if provided must be equal to or after the `createdAfter` date and at least two minutes before the time of the request. If `createdBefore` is provided, neither `lastUpdatedAfter` nor `lastUpdatedBefore` may be provided.
     * @param  ?\DateTimeInterface  $lastUpdatedAfter  The response includes orders updated at or after this time. An update is defined as any change made by Amazon or by the seller, including an update to the order status. The date must be in [ISO 8601](https://developer-docs.amazon.com/sp-api/docs/iso-8601) format.
     *
     * **Note**: You must provide exactly one of `createdAfter` and `lastUpdatedAfter`. If `lastUpdatedAfter` is provided, neither `createdAfter` nor `createdBefore` may be provided.
     * @param  ?\DateTimeInterface  $lastUpdatedBefore  The response includes orders updated at or before this time. An update is defined as any change made by Amazon or by the seller, including an update to the order status. The date must be in [ISO 8601](https://developer-docs.amazon.com/sp-api/docs/iso-8601) format.
     *
     * **Note**: If you include `lastUpdatedAfter` in the request, `lastUpdatedBefore` is optional, and if provided must be equal to or after the `lastUpdatedAfter` date and at least two minutes before the time of the request. If `lastUpdatedBefore` is provided, neither `createdAfter` nor `createdBefore` may be provided.
     * @param  ?array  $fulfillmentStatuses  A list of `FulfillmentStatus` values you can use to filter the results.
     * @param  ?array  $marketplaceIds  The response includes orders that were placed in marketplaces you include in this list.
     *
     * Refer to [Marketplace IDs](https://developer-docs.amazon.com/sp-api/docs/marketplace-ids) for a complete list of `marketplaceId` values.
     * @param  ?array  $fulfilledBy  The response includes orders that are fulfilled by the parties that you include in this list.
     * @param  ?int  $maxResultsPerPage  The maximum number of orders that can be returned per page. The value must be between 1 and 100. **Default:** 100.
     * @param  ?string  $paginationToken  Pagination occurs when a request produces a response that exceeds the `maxResultsPerPage`. This means that the response is divided into individual pages. To retrieve the next page, you must pass the `nextToken` value as the `paginationToken` query parameter in the next request. You will not receive a `nextToken` value on the last page.
     * @param  ?array  $includedData  A list of datasets to include in the response.
     */
    public function __construct(
        protected ?\DateTimeInterface $createdAfter = null,
        protected ?\DateTimeInterface $createdBefore = null,
        protected ?\DateTimeInterface $lastUpdatedAfter = null,
        protected ?\DateTimeInterface $lastUpdatedBefore = null,
        protected ?array $fulfillmentStatuses = null,
        protected ?array $marketplaceIds = null,
        protected ?array $fulfilledBy = null,
        protected ?int $maxResultsPerPage = null,
        protected ?string $paginationToken = null,
        protected ?array $includedData = null,
    ) {}

    public function resolveEndpoint(): string
    {
        return '/orders/2026-01-01/orders';
    }

    public function createDtoFromResponse(Response $response): SearchOrdersResponse|ErrorList
    {
        $status = $response->status();
        $responseCls = match ($status) {
            200 => SearchOrdersResponse::class,
            400, 403, 404, 413, 415, 429, 500, 503 => ErrorList::class,
            default => throw new Exception("Unhandled response status: {$status}")
        };

        return $responseCls::deserialize($response->json());
    }

    public function defaultQuery(): array
    {
        return array_filter([
            'createdAfter' => $this->createdAfter?->format('Y-m-d\TH:i:s\Z'),
            'createdBefore' => $this->createdBefore?->format('Y-m-d\TH:i:s\Z'),
            'lastUpdatedAfter' => $this->lastUpdatedAfter?->format('Y-m-d\TH:i:s\Z'),
            'lastUpdatedBefore' => $this->lastUpdatedBefore?->format('Y-m-d\TH:i:s\Z'),
            'fulfillmentStatuses' => $this->fulfillmentStatuses,
            'marketplaceIds' => $this->marketplaceIds,
            'fulfilledBy' => $this->fulfilledBy,
            'maxResultsPerPage' => $this->maxResultsPerPage,
            'paginationToken' => $this->paginationToken,
            'includedData' => $this->includedData,
        ]);
    }
}
